{% extends "base.html" %}
{% load static %}

<title>{% block title %}Dashboard{% endblock title %}</title>

{% block content%}


{% include 'dashboard_sidebar.html' %}

<div class="app-wrapper">

    <div class="app-content pt-3 p-md-3 p-lg-4">
        <div class="container-xl">

            <h1 class="app-page-title">Overview</h1>
            <div class="row g-4 mb-4">
                {% for stat in stats_figures %}
                <div class="col-4 col-md-2">
                    <div class="app-card app-card-stat shadow-sm h-100">
                        <div class="app-card-body p-3 p-lg-4">
                            <h4 class="stats-type mb-1">{{ stat.title }}</h4>
                            <div class="stats-figure">{{ stat.figure }}</div>
                            <div class="{% if stat.meta_class %}{{ stat.meta_class }}{% endif %}">
                                {% if stat.icon %}
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi {{ stat.icon }}"
                                    fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
                                </svg> {{ stat.meta }}
                                {% else %}
                                <b>{{ stat.meta }}</b>
                                {% endif %}
                            </div>
                        </div>
                        <a class="app-card-link-mask" href="#"></a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div><!--//row-->

        <div class="row g-4 mb-4">
            <div class="col-12 col-lg-6">
                <div class="app-card app-card-progress-list h-100 shadow-sm">
                    <div class="app-card-header p-3">
                        <div class="row justify-content-between align-items-center">
                            <div class="col-auto">
                                <h4 class="app-card-title">Top 10 Most Ordered Products</h4>
                            </div>
                            <div class="col-auto">
                                <div class="card-header-action">
                                    <p>Quantity</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="app-card-body">
                        {% for product_info in top_ordered_products %}
                        <div class="item p-3">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="title mb-1">{{ product_info.product.name }}</div>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar"
                                            style="width: {{ product_info.total_quantity }}%;"
                                            aria-valuenow="{{ product_info.total_quantity }}" aria-valuemin="0"
                                            aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    {{ product_info.total_quantity }}
                                </div>
                            </div>
                            <a class="item-link-mask" href="{% url 'products:product_detail' product_info.id %}"></a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="app-card app-card-stats-table h-100 shadow-sm">
                    <div class="app-card-header p-3">
                        <div class="row justify-content-between align-items-center">
                            <div class="col-auto">
                                <h4 class="app-card-title">Installment Statistics by Product</h4>
                            </div><!--//col-->
                            <div class="col-auto">
                                <div class="card-header-action">
                                    <a href="#">View report</a>
                                </div><!--//card-header-actions-->
                            </div><!--//col-->
                        </div><!--//row-->
                    </div><!--//app-card-header-->
                    <div class="app-card-body p-3 p-lg-4">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0">
                                <thead>
                                    <tr>
                                        <th class="meta">Product Name</th>
                                        <th class="meta stat-cell">Installments</th>
                                        <th class="meta stat-cell">Paid</th>
                                        <th class="meta stat-cell">Unpaid</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stat in stats %}
                                    <tr>
                                        <td><a href="{% url 'products:product_detail' stat.id %}">{{ stat.product_name}}</a></td>
                                        <td class="stat-cell">{{ stat.total_installments }}</td>
                                        <td class="stat-cell">{{ stat.paid_installments }}</td>
                                        <td class="stat-cell">{{ stat.unpaid_installments }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div><!--//table-responsive-->
                    </div><!--//app-card-body-->
                </div><!--//app-card-->
            </div><!--//col-->
        </div><!--//row-->
        <div class="row g-4 mb-4">
            
            <div class="row g-4 mb-4">
                <div class="col-12 col-lg-6">
                    <div class="app-card app-card-chart h-100 shadow-sm">
                        <div class="app-card-header p-3 text-center">
                            <h4 class="app-card-title">Last Month's Orders for {{ current_year }}</h4>
                        </div>
                        <div class="app-card-body p-3 p-lg-4">
                            <div class="chart-container">
                                <canvas id="canvas-barchart-1"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-lg-6">
                    <div class="app-card app-card-chart h-100 shadow-sm">
                        <div class="app-card-header p-3">
                            <h4 class="app-card-title">Another Chart Example</h4>
                        </div>
                        <div class="app-card-body p-3 p-lg-4">
                            <div class="chart-container">
                                <canvas id="canvas-barchart-2" data-chart-data='[30, 50, 60, 80, 90, 20, 100]' data-chart-labels='["Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]'></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div><!--//container-xl-->
    </div><!--//app-content-->
</div><!--//app-wrapper-->
<script>
    window.chartColors = {
        green: 'rgba(75, 192, 192, 1)',
        border: 'rgba(200, 200, 200, 1)'
    };

    function createBarChart(canvasId, data, labels) {
        var ctx = document.getElementById(canvasId).getContext('2d');
        if (!ctx) {
            console.error(`Canvas with ID ${canvasId} not found.`);
            return; // Exit if the canvas is not found
        }
        var config = {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Orders',
                    backgroundColor: window.chartColors.green,
                    data: data
                }]
            },
            options: {
                responsive: true,
                aspectRatio: 1.5,
                legend: {
                    position: 'bottom',
                    align: 'end',
                },
                title: {
                    display: true,
                    text: '',
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    xAxes: [{
                        display: true,
                        gridLines: {
                            drawBorder: false,
                            color: window.chartColors.border,
                        },
                    }],
                    yAxes: [{
                        display: true,
                        gridLines: {
                            drawBorder: false,
                            color: window.chartColors.border,
                        },
                    }]
                }
            }
        };
        return new Chart(ctx, config);
    }

    window.addEventListener('DOMContentLoaded', function () {
        try {
            var barData1 = {{ order_counts|safe }};
            var barLabels1 = {{ months|safe }};

            createBarChart('canvas-barchart-1', barData1, barLabels1);

            var barData2 = JSON.parse(document.getElementById('canvas-barchart-2').dataset.chartData);
            var barLabels2 = JSON.parse(document.getElementById('canvas-barchart-2').dataset.chartLabels);
            createBarChart('canvas-barchart-2', barData2, barLabels2);
        } catch (error) {
            console.error('Error parsing data:', error);
        }
    });
</script>

{% endblock content %}