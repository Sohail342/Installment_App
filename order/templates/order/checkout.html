{% load static %}

{% block content %}
<section class="ftco-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-7 ftco-animate">
                {% if cart_is_empty %}
                <h3>Your cart is empty</h3>
                <a href="{% url 'products:category_list' %}" class="btn btn-primary">Continue Shopping</a>
                {% else %}
                <form action="{% url 'order:checkout' user.id %}" class="billing-form" method="POST">
                    {% csrf_token %}
                    <h3 class="mb-4 billing-heading">Customer Details</h3>
                    <div class="row align-items-end">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="firstname">First Name*</label>
                                <input type="text" class="form-control" placeholder="" name="firstname" required>
                                <!-- Field error -->
                                {% if form.firstname.errors %}
                                <p class="text-danger">{{ form.firstname.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="lastname">Last Name (Optional)</label>
                                <input type="text" class="form-control" placeholder="" name="lastname">
                                <!-- Field error -->
                                {% if form.lastname.errors %}
                                <p class="text-danger">{{ form.lastname.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="country">State / Country</label>
                                <div class="select-wrap">
                                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                                    <select name="country" id="country" class="form-control">
                                        <option value="Pakistan">Pakistan</option>
                                    </select>
                                    <!-- Field error -->
                                    {% if form.country.errors %}
                                    <p class="text-danger">{{ form.country.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="streetaddress">Street Address*</label>
                                <input type="text" class="form-control" name="streetaddress"
                                    placeholder="House number and street name" required>
                                <!-- Field error -->
                                {% if form.streetaddress.errors %}
                                <p class="text-danger">{{ form.streetaddress.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <input type="text" class="form-control" name="apartment"
                                    placeholder="Apartment, suite, unit etc: (optional)">
                                <!-- Field error -->
                                {% if form.apartment.errors %}
                                <p class="text-danger">{{ form.apartment.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="towncity">Town / City*</label>
                                <input type="text" name="towncity" class="form-control" placeholder="" required>
                                <!-- Field error -->
                                {% if form.towncity.errors %}
                                <p class="text-danger">{{ form.towncity.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="postcodezip">Postcode / ZIP (Optional)</label>
                                <input type="text" name="postcodezip" class="form-control" placeholder="">
                                <!-- Field error -->
                                {% if form.postcodezip.errors %}
                                <p class="text-danger">{{ form.postcodezip.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="phone">Phone*</label>
                                <input type="text" name="phone" class="form-control" placeholder="" required>
                                <!-- Field error -->
                                {% if form.phone.errors %}
                                <p class="text-danger">{{ form.phone.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="emailaddress">Email Address*</label>
                                <input type="email" name="emailaddress" class="form-control" placeholder="" required>
                                <!-- Field error -->
                                {% if form.emailaddress.errors %}
                                <p class="text-danger">{{ form.emailaddress.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="w-100"></div>
                    </div>

            </div>
            <div class="col-xl-5">
                <div class="row mt-5 pt-3">
                    <div class="col-md-12 d-flex mb-5">
                        <div class="cart-detail cart-total p-3 p-md-4">
                            <h3 class="billing-heading mb-4">Cart Total</h3>
                            <span>Total Items: </span>
                            <span>
                                {% for item in cart_items %}
                                {{ item.quantity }} x {{ item.product.name }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                            <p class="d-flex">
                                <span>Total: </span>
                                <span>Rs. {{ subtotal }}</span>
                            </p>
                            <p class="d-flex">
                                <span>Delivery</span>
                                <span>Rs.{{product_delivery_fee}}</span>
                            </p>
                            <hr>
                            <p class="d-flex total-price">
                                <span>Total</span>
                                <span>Rs.{{total}}</span>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="cart-detail p-3 p-md-4">
                            <h3 class="billing-heading mb-4">Payment Method</h3>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="radio">
                                        <label><input type="radio" name="payment_method" value="COD" class="mr-2"
                                                required>COD</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="checkbox">
                                        <label><input type="checkbox" value="" class="mr-2" required>I have read and
                                            accept the <a href="#">terms and conditions<a /></label>
                                    </div>
                                </div>
                            </div>
                            <select name="installment_plan" class="form-select ms-2" required>
                                <option value="" disabled selected>Select Installment Plan</option>
                                <option value="12_months">12 Months</option>
                                <option value="9_months">9 Months</option>
                                <option value="6_months">6 Months</option>
                                <option value="3_months">3 Months</option>
                            </select>
                            <input type="hidden" name="payment_method" id="hidden-payment-method" value="" required>
                            <button type="submit" class="btn btn-primary py-3 px-4">Place an order</button>
                            <!-- Non-field errors -->
                            {% if form.non_field_errors %}
                            <p class="text-danger">{{ form.non_field_errors }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div> <!-- .col-md-8 -->
            </form>
            {% endif %}
        </div>
    </div>
</section> <!-- .section -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get all radio buttons and the hidden input
        const radios = document.querySelectorAll('input[name="payment_method"]');
        const hiddenInput = document.getElementById('hidden-payment-method');

        // Add change event listener to all radio buttons
        radios.forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.checked) {
                    hiddenInput.value = this.value;
                }
            });
        });
    });
</script>
{% endblock %}