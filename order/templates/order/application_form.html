{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Application Form{% endblock title %}</title>
{% block content %}
<section class="ftco-section">
    <div class="container my-1">
        <div class="row justify-content-center">
            <!-- Main Form (Left Side) -->
            <div class="col-md-12">
                {% if cart_is_empty %}
                <h3 class="text-center">Your cart is empty</h3>
                <div class="text-center">
                    <a href="{% url 'products:category_list' %}" class="btn btn-primary">Continue Shopping</a>
                </div>
                {% else %}
                <form action="{% url 'order:checkout' user.id %}"
                    class="billing-form border border-primary rounded p-4 bg-light mx-auto my-1"
                    method="POST">
                    {% csrf_token %}
                    <h3 class="mb-4 billing-heading">Application Form</h3>

                    <!-- Display non-field errors here -->
                    {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="firstname">First Name*</label>
                                <input type="text" class="form-control" name="firstname" placeholder="Customer Name"
                                    required>
                                {% if form.firstname.errors %}
                                <div class="invalid-feedback">{{ form.firstname.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="lastname">Last Name (Optional)</label>
                                <input type="text" class="form-control" name="lastname" placeholder="Last Name">
                                {% if form.lastname.errors %}
                                <div class="invalid-feedback">{{ form.lastname.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group mb-4">
                                <label for="country">State / Country</label>
                                <select name="country" id="country" class="form-control">
                                    <option value="Pakistan">Pakistan</option>
                                </select>
                                {% if form.country.errors %}
                                <div class="invalid-feedback">{{ form.country.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="streetaddress">Street Address*</label>
                                <input type="text" class="form-control" name="streetaddress"
                                    placeholder="House number and street name" required>
                                {% if form.streetaddress.errors %}
                                <div class="invalid-feedback">{{ form.streetaddress.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="apartment"></label>
                                <input type="text" class="form-control" name="apartment"
                                    placeholder="Apartment, suite, unit etc: (optional)">
                                {% if form.apartment.errors %}
                                <div class="invalid-feedback">{{ form.apartment.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="cnic_no">CNIC No*</label>
                                <input type="text" name="cnic_no" class="form-control"
                                    placeholder="e.g, 12345-1234567-1" oninput="formatCNIC(this)">
                                {% if form.cnic_no.errors %}
                                <div class="invalid-feedback">{{ form.cnic_no.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="towncity">Town / City*</label>
                                <input type="text" name="towncity" class="form-control" placeholder="e.g, Karachi"
                                    required>
                                {% if form.towncity.errors %}
                                <div class="invalid-feedback">{{ form.towncity.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="phone">Phone*</label>
                                <input type="text" name="phone" class="form-control" placeholder="e.g, 03429812112"
                                    required>
                                {% if form.phone.errors %}
                                <div class="invalid-feedback">{{ form.phone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="emailaddress">Email Address</label>
                                <input type="email" name="emailaddress" class="form-control"
                                    placeholder="example@gmail.com">
                                {% if form.emailaddress.errors %}
                                <div class="invalid-feedback">{{ form.emailaddress.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="father_name">Father's Name</label>
                                <input type="text" class="form-control" name="father_name" placeholder="Father's Name">
                                {% if form.father_name.errors %}
                                <div class="invalid-feedback">{{ form.father_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="occupation">Occupation</label>
                                <input type="text" class="form-control" name="occupation" placeholder="Occupation">
                                {% if form.customer_occupation.errors %}
                                <div class="invalid-feedback">{{ form.customer_occupation.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="customer_designation">Designation</label>
                                <input type="text" class="form-control" name="customer_designation" placeholder="Designation">
                                {% if form.customer_designation.errors %}
                                <div class="invalid-feedback">{{ form.customer_designation.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="customer_monthly_income">Monthly Income</label>
                                <input type="number" class="form-control" name="customer_monthly_income"
                                    placeholder="Monthly Income">
                                {% if form.customer_monthly_income.errors %}
                                <div class="invalid-feedback">{{ form.customer_monthly_income.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group mb-4">
                                <label for="customer_office_address">Office/Business Address</label>
                                <input type="text" class="form-control" name="customer_office_address"
                                    placeholder="Office/Business Address">
                                {% if form.customer_office_address.errors %}
                                <div class="invalid-feedback">{{ form.customer_office_address.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="customer_home_phone">Home Phone</label>
                                <input type="text" class="form-control" name="customer_home_phone" placeholder="Home Phone">
                                {% if form.customer_home_phone.errors %}
                                <div class="invalid-feedback">{{ form.customer_home_phone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-4">
                                <label for="customer_office_phone">Office Phone</label>
                                <input type="text" class="form-control" name="customer_office_phone" placeholder="Office Phone">
                                {% if form.customer_office_phone.errors %}
                                <div class="invalid-feedback">{{ form.customer_office_phone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!--Guaranteed 1-->
                    <div class="cart-detail cart-total p-3">
                        <h3 class="billing-heading mb-4">Guaranteed No. 1</h3>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_cnic_no">CNIC No*</label>
                                    <input type="text" name="guaranteed_cnic_no" class="form-control"
                                        placeholder=" e.g, 12345-1234567-1" oninput="formatCNIC(this)" required>
                                    {% if form.guaranteed_cnic_no.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_cnic_no.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_name">Name*</label>
                                    <input type="text" name="guaranteed_name" class="form-control" placeholder="Your Name"
                                        required>
                                    {% if form.guaranteed_name.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_father_name">Father's Name</label>
                                    <input type="text" name="guaranteed_father_name" class="form-control"
                                        placeholder="Father's Name">
                                    {% if form.guaranteed_father_name.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_father_name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_occupation">Occupation</label>
                                    <input type="text" name="guaranteed_occupation" class="form-control" placeholder="Occupation">
                                    {% if form.guaranteed_occupation.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_occupation.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_residential_address">Residential Address</label>
                                    <input type="text" name="guaranteed_residential_address" class="form-control"
                                        placeholder="Residential Address">
                                    {% if form.guaranteed_residential_address.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_residential_address.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_designation">Designation</label>
                                    <input type="text" name="guaranteed_designation" class="form-control"
                                        placeholder="Designation">
                                    {% if form.guaranteed_designation.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_designation.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_monthly_income">Monthly Income</label>
                                    <input type="number" name="guaranteed_monthly_income" class="form-control"
                                        placeholder="Monthly Income">
                                    {% if form.guaranteed_monthly_income.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_monthly_income.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_office_address">Office/Business Address</label>
                                    <input type="text" name="guaranteed_office_address" class="form-control"
                                        placeholder="Office/Business Address">
                                    {% if form.guaranteed_office_address.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_office_address.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="guaranteed_office_phone">Office Phone</label>
                                    <input type="text" name="guaranteed_office_phone" class="form-control"
                                        placeholder="Office Phone">
                                    {% if form.guaranteed_office_phone.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_office_phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_phone_no">Phone No*</label>
                                    <input type="text" name="guaranteed_phone_no" class="form-control" placeholder="Phone No"
                                        required>
                                    {% if form.guaranteed_phone_no.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_phone_no.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed_home_phone">Home Phone</label>
                                    <input type="text" name="guaranteed_home_phone" class="form-control" placeholder="Home Phone">
                                    {% if form.guaranteed_home_phone.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed_home_phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--Guaranteed 2-->
                    <div class="cart-detail cart-total p-3">
                        <h3 class="billing-heading mb-4">Guaranteed No. 2</h3>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_cnic_no">CNIC No</label>
                                    <input type="text" name="guaranteed2_cnic_no" class="form-control"
                                        placeholder=" e.g, 12345-1234567-1" oninput="formatCNIC(this)">
                                    {% if form.guaranteed2_cnic_no.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_cnic_no.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_name">Name</label>
                                    <input type="text" name="guaranteed2_name" class="form-control" placeholder="Your Name">
                                    {% if form.guaranteed2_name.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_father_name">Father's Name</label>
                                    <input type="text" name="guaranteed2_father_name" class="form-control"
                                        placeholder="Father's Name">
                                    {% if form.guaranteed2_father_name.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_father_name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_occupation">Occupation</label>
                                    <input type="text" name="guaranteed2_occupation" class="form-control" placeholder="Occupation">
                                    {% if form.guaranteed2_occupation.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_occupation.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_residential_address">Residential Address</label>
                                    <input type="text" name="guaranteed2_residential_address" class="form-control"
                                        placeholder="Residential Address">
                                    {% if form.guaranteed2_residential_address.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_residential_address.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_designation">Designation</label>
                                    <input type="text" name="guaranteed2_designation" class="form-control"
                                        placeholder="Designation">
                                    {% if form.guaranteed2_designation.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_designation.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_monthly_income">Monthly Income</label>
                                    <input type="number" name="guaranteed2_monthly_income" class="form-control"
                                        placeholder="Monthly Income">
                                    {% if form.guaranteed2_monthly_income.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_monthly_income.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_office_address">Office/Business Address</label>
                                    <input type="text" name="guaranteed2_office_address" class="form-control"
                                        placeholder="Office/Business Address">
                                    {% if form.guaranteed2_office_address.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_office_address.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="guaranteed2_office_phone">Office Phone</label>
                                    <input type="text" name="guaranteed2_office_phone" class="form-control"
                                        placeholder="Office Phone">
                                    {% if form.guaranteed2_office_phone.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_office_phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_phone_no">Phone No</label>
                                    <input type="text" name="guaranteed2_phone_no" class="form-control" placeholder="Phone No">
                                    {% if form.guaranteed2_phone_no.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_phone_no.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-4">
                                    <label for="guaranteed2_home_phone">Home Phone</label>
                                    <input type="text" name="guaranteed2_home_phone" class="form-control" placeholder="Home Phone">
                                    {% if form.guaranteed2_home_phone.errors %}
                                    <div class="invalid-feedback">{{ form.guaranteed2_home_phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="cart-detail cart-total p-3 p-md-4">
                            <h3 class="billing-heading mb-4">Total Bill</h3>
                            <span>Total Items:</span>
                            <span>
                                {% for item in cart_items %}
                                <img src="{{ item.product.photo.url }}" alt="{{ item.product.name }}"
                                    style="width: 50px; height: auto;" class="mr-2">
                                {{ item.quantity }} x {{ item.product.name }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                            <style>
                                .label-spacing {
                                    margin-right: 4rem;
                                }
                            </style>

                            <div class="mt-3">
                                <p class="d-flex justify-content-between">
                                    <span class="label-spacing">Down Payment</span>
                                    <span>{{ down_payment_againts_hire | intcomma:False }} PKR</span>
                                </p>
                                <p class="d-flex justify-content-between">
                                    <span class="label-spacing">Installment/Month</span>
                                    <span>{{ product_delivery_fee | intcomma:False }} PKR</span>
                                </p>
                                <p class="d-flex justify-content-between">
                                    <span class="label-spacing">Total Installments</span>
                                    <span>{{ total_installments }} X</span>
                                </p>
                                <p class="d-flex justify-content-between">
                                    <span class="label-spacing">Form fee</span>
                                    <span>{{ 500 | intcomma:False }} PKR</span>
                                </p>
                            </div>
                            <hr>
                            <p class="d-flex justify-content-between total-price">
                                <span><b>Total</b></span>
                                <span><b>{{ total | intcomma:False }} PKR</b></span>
                            </p>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="cart-detail p-3 p-md-4">
                            <h3 class="billing-heading mb-4">Mode of Payment</h3>
                            <div class="form-group">
                                <div class="col-md-12 ">
                                    <div class="form-check mb-3">
                                        <input checked type="radio" name="payment_method" value="Installment"
                                            class="form-check-input" id="installment" required>
                                        <label class="form-check-label" for="installment">Every Month</label>
                                    </div>
                                    <button type="submit" class="btn btn-primary py-3 px-4">Confirm order</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</section>
<script>
    function formatCNIC(input) {
        // Remove non-digit characters
        const digits = input.value.replace(/\D/g, '');

        // Format the digits
        let formatted = '';
        if (digits.length > 0) {
            formatted += digits.substring(0, 5); // First 5 digits
        }
        if (digits.length > 5) {
            formatted += '-' + digits.substring(5, 12); // Next 7 digits
        }
        if (digits.length > 12) {
            formatted += '-' + digits.charAt(12); // Last digit
        }

        // Update the input value
        input.value = formatted;
    }
</script>
{% endblock %}